<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amit - mikveh henna party!</title>
  <style>
    :root{
      --cream:#FAF3E5;
      --blue:#197D8F;
    }
    html, body {
      margin:0;
      padding:0;
      height:100svh;               /* stable mobile height */
      overflow:hidden;             /* no scrolling */
      font-family: Arial, sans-serif;
      direction: rtl;
      background: var(--cream);
      -webkit-tap-highlight-color: transparent;
    }

    /* Stage holds the image and the overlayed form */
    .stage{
      position:fixed;
      inset:0;
      display:block;
      background:var(--cream);
    }
    .stage img{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      width:100vw;
      height:100svh;
      object-fit:contain;          /* desktop/tablet: show whole invite */
      object-position:center center;
      display:block;
      pointer-events:none;         /* avoid accidental drag */
      user-select:none;
    }

    /* Form overlay (desktop/tablet positioned via JS below) */
    .form-wrapper{
      position:absolute;           /* top/left set by JS */
      transform:translate(-50%,0); /* center horizontally around left 50% */
      width:100%;
      max-width:320px;             /* cap on tablets */
      padding:0 16px;
      z-index:2;
    }
    form{
      background:rgba(250,243,229,.96);
      padding:12px 14px;
      border-radius:12px;
      box-shadow:0 4px 18px rgba(0,0,0,.12);
      margin:0 auto;
      max-width:260px;
    }
    input, button{
      width:100%;
      box-sizing:border-box;
      padding:10px;
      margin:8px 0;
      font-size:16px;
      border-radius:8px;
      border:1px solid #cfcfcf;
      text-align:right;
    }
    .row{
      display:flex; align-items:center; gap:8px; justify-content:flex-start;
    }
    .row input[type="checkbox"]{ width:auto; margin:0; }
    button{
      background:#fff;
      color:var(--blue);
      font-weight:700;
      border:2px solid var(--blue);
      cursor:pointer;
    }
    .spinner{
      margin:12px auto; width:28px; height:28px;
      border:4px solid #d0d0d0; border-top:4px solid var(--blue);
      border-radius:50%; display:none; animation:spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg);} }
    #responseMsg{ margin-top:10px; font-weight:700; font-size:14px; text-align:center; }

    /* ==== MOBILE ONLY: fill screen (allow bottom crop) + place form ==== */
    @media (max-width: 767px) {
      html, body {
        height:100svh;
        overflow:hidden;
        background:none; /* we render with the <img> */
      }
      .stage img{
        width:100vw;
        height:100svh;
        object-fit:cover;           /* fill screen, crop bottom if needed */
        object-position:top center; /* keep header/top perfect */
      }
      /* On mobile we pin the form with a stable top; JS will skip positioning */
      .form-wrapper{
        position:fixed;
        top:64svh;                  /* tweak 62–66svh to taste */
        left:50%;
        transform:translateX(-50%);
        width:100%;
        padding:0 16px;
      }
      form{ max-width:260px; }
    }
  </style>
</head>
<body>

  <div class="stage">
    <!-- Use your tall image here -->
    <img id="inviteImg" src="henna1.png" alt="Invitation">
    <div id="formWrap" class="form-wrapper">
      <form id="rsvpForm">
        <input type="text" id="name" name="name" placeholder="השם שלך" required>

        <div class="row">
          <input type="checkbox" id="attendYes">
          <label for="attendYes">מגיעה</label>
        </div>
        <div class="row">
          <input type="checkbox" id="attendNo">
          <label for="attendNo">לא מגיעה</label>
        </div>

        <!-- API field -->
        <input type="hidden" id="attendance" name="attendance" value="לא מגיע/ה">

        <button type="submit">שליחה</button>

        <div id="spinner" class="spinner"></div>
        <p id="responseMsg"></p>
      </form>
    </div>
  </div>

  <script>
    // ====== CONFIG (desktop/tablet only): form anchor inside the image ======
    const ANCHOR_Y = 0.63; // try 0.62–0.66 to fine‑tune on your export

    const img = document.getElementById('inviteImg');
    const wrap = document.getElementById('formWrap');
    const mqMobile = window.matchMedia('(max-width: 767px)');

    function placeFormDesktop(){
      const r = img.getBoundingClientRect();
      if (!r.width || !r.height) return;

      const y = Math.round(r.top + r.height * ANCHOR_Y);
      const x = Math.round(r.left + r.width / 2);

      wrap.style.top = y + 'px';
      wrap.style.left = x + 'px';
      wrap.style.position = 'absolute';
      wrap.style.transform = 'translate(-50%,0)';

      // keep visible on short windows
      const fRect = wrap.querySelector('form').getBoundingClientRect();
      const bottom = y + fRect.height;
      const limit = window.innerHeight - 8;
      if (bottom > limit){
        wrap.style.top = Math.max(8, limit - fRect.height) + 'px';
      }
    }

    function applyLayout(){
      if (mqMobile.matches){
        // Mobile: CSS controls top/left; do nothing here.
        return;
      }
      // Desktop/tablet: position relative to image
      placeFormDesktop();
    }

    img.addEventListener('load', applyLayout);
    window.addEventListener('resize', applyLayout);
    mqMobile.addEventListener?.('change', applyLayout);
    setTimeout(applyLayout, 400); // iOS paint delay

    // ====== RSVP logic (same API fields) ======
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwQeOi50DvDvKjun1ioqITP9CJNTauXOV0XpsLPqtpfRuiWrRBFlEUxhIR97VKh8yTubg/exec';
    const form = document.getElementById('rsvpForm');
    const msg = document.getElementById('responseMsg');
    const spinner = document.getElementById('spinner');
    const attendYes = document.getElementById('attendYes');
    const attendNo = document.getElementById('attendNo');
    const attendanceHidden = document.getElementById('attendance');

    function syncAttendance(){
      if (this === attendYes && attendYes.checked){
        attendNo.checked = false; attendanceHidden.value = 'מגיע/ה';
      } else if (this === attendNo && attendNo.checked){
        attendYes.checked = false; attendanceHidden.value = 'לא מגיע/ה';
      } else if (!attendYes.checked && !attendNo.checked){
        attendanceHidden.value = 'לא מגיע/ה';
      }
    }
    attendYes.addEventListener('change', syncAttendance);
    attendNo.addEventListener('change', syncAttendance);

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      spinner.style.display = 'block';
      msg.textContent = '';

      fetch(scriptURL, { method:'POST', body: fd /*, mode:'no-cors' if needed */ })
      .then(r => r.text?.() ?? '')
      .then(() => {
        spinner.style.display = 'none';
        msg.textContent = '✅ תודה! נשמר בהצלחה';
        form.reset();
        attendanceHidden.value = 'לא מגיע/ה';
        if (!mqMobile.matches) applyLayout(); // re-place on desktop if height changed
      })
      .catch(() => {
        spinner.style.display = 'none';
        msg.textContent = 'שגיאה בשליחה ❌';
      });
    });
  </script>

</body>
</html>
